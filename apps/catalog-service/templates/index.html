<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TalknShop Catalog - Product Search</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container { max-width: 1200px; margin: 0 auto; }
        .header { text-align: center; color: white; margin-bottom: 30px; }
        .header h1 { font-size: 2.5em; margin-bottom: 10px; }
        .search-box { background: white; border-radius: 12px; padding: 30px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); margin-bottom: 30px; }
        .search-form { display: flex; gap: 10px; margin-bottom: 20px; }
        .search-input { flex: 1; padding: 15px 20px; font-size: 16px; border: 2px solid #e0e0e0; border-radius: 8px; transition: border-color 0.3s; }
        .search-input:focus { outline: none; border-color: #667eea; }
        .search-btn { padding: 15px 30px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; transition: transform 0.2s, box-shadow 0.2s; }
        .search-btn:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4); }
        .search-btn:active { transform: translateY(0); }
        .filters { display: flex; gap: 15px; flex-wrap: wrap; }
        .filter-group { display: flex; flex-direction: column; gap: 5px; }
        .filter-group label { font-size: 12px; color: #666; font-weight: 600; }
        .filter-input { padding: 10px; border: 2px solid #e0e0e0; border-radius: 6px; font-size: 14px; }
        .filter-input:focus { outline: none; border-color: #667eea; }
        .loading { text-align: center; padding: 40px; color: white; font-size: 18px; display: none; }
        .loading.active { display: block; }
        .results-info { background: white; border-radius: 12px; padding: 20px; margin-bottom: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .results-count { font-size: 18px; color: #333; font-weight: 600; }
        .products-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; }
        .product-card { background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 5px 15px rgba(0,0,0,0.1); transition: transform 0.3s, box-shadow 0.3s; cursor: pointer; }
        .product-card:hover { transform: translateY(-5px); box-shadow: 0 10px 25px rgba(0,0,0,0.2); }
        .product-image { width: 100%; height: 250px; object-fit: contain; background: #f8f8f8; padding: 10px; }
        .product-info { padding: 15px; }
        .product-title { font-size: 16px; font-weight: 600; color: #333; margin-bottom: 10px; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
        .product-brand { font-size: 14px; color: #666; margin-bottom: 10px; }
        .product-price { font-size: 20px; font-weight: 700; color: #667eea; margin-bottom: 10px; }
        .product-rating { display: flex; align-items: center; gap: 8px; color: #fbbf24; font-weight: 600; margin-bottom: 10px; }
        .product-rating .count { color: #666; font-weight: 400; }
        .product-platform { display: inline-block; background: #f3f4f6; color: #4b5563; padding: 6px 12px; border-radius: 999px; font-size: 12px; font-weight: 600; margin-bottom: 10px; }
        .product-availability { font-size: 12px; font-weight: 700; color: #10b981; text-transform: uppercase; letter-spacing: 0.5px; }
        .footer { text-align: center; color: white; margin-top: 30px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>TalknShop Catalog</h1>
            <p>Search products from Amazon (RapidAPI) and Kroger</p>
        </div>

        <div class="search-box">
            <form class="search-form" onsubmit="event.preventDefault(); performSearch();">
                <input type="text" id="searchInput" class="search-input" placeholder="Search products..." required>
                <button type="submit" class="search-btn">Search</button>
            </form>

            <div class="filters">
                <div class="filter-group">
                    <label>Min Price ($)</label>
                    <input type="number" id="priceMin" class="filter-input" placeholder="0">
                </div>
                <div class="filter-group">
                    <label>Max Price ($)</label>
                    <input type="number" id="priceMax" class="filter-input" placeholder="1000">
                </div>
                <div class="filter-group">
                    <label>Platforms</label>
                    <select id="platforms" class="filter-input" multiple>
                        <option value="amazon" selected>Amazon (RapidAPI)</option>
                        <option value="kroger">Kroger</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Sort By</label>
                    <select id="sortBy" class="filter-input">
                        <option value="">Relevance</option>
                        <option value="price_asc">Price: Low to High</option>
                        <option value="price_desc">Price: High to Low</option>
                        <option value="rating_desc">Rating: High to Low</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Results per Page</label>
                    <input type="number" id="pageSize" class="filter-input" value="20" min="1" max="100">
                </div>
            </div>
        </div>

        <div id="loading" class="loading">Searching products...</div>

        <div id="resultsInfo" class="results-info" style="display:none;">
            <div class="results-count"></div>
        </div>

        <div id="productsGrid" class="products-grid"></div>

        <div class="footer">
            <p>Powered by TalknShop • RapidAPI Amazon • Kroger API</p>
        </div>
    </div>

    <script>
        const loading = document.getElementById('loading');
        const productsGrid = document.getElementById('productsGrid');
        const resultsInfo = document.getElementById('resultsInfo');
        const resultsCount = resultsInfo.querySelector('.results-count');

        async function performSearch(page = 1) {
            const query = document.getElementById('searchInput').value.trim();
            const priceMin = document.getElementById('priceMin').value;
            const priceMax = document.getElementById('priceMax').value;
            const platforms = Array.from(document.getElementById('platforms').selectedOptions).map(opt => opt.value);
            const sortBy = document.getElementById('sortBy').value;
            const pageSize = document.getElementById('pageSize').value || 20;

            if (!query) return;

            const payload = {
                query,
                filters: {
                    price_min: priceMin ? parseFloat(priceMin) : null,
                    price_max: priceMax ? parseFloat(priceMax) : null,
                    platforms: platforms.length ? platforms : ["amazon"]
                },
                pagination: {
                    page: page,
                    size: parseInt(pageSize)
                },
                sort_by: sortBy || null
            };

            loading.classList.add('active');
            productsGrid.innerHTML = '';
            resultsInfo.style.display = 'none';

            try {
                const response = await fetch('/api/v1/search', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.detail || 'Search failed');
                }

                renderResults(data);
            } catch (error) {
                alert('Error: ' + error.message);
            } finally {
                loading.classList.remove('active');
            }
        }

        function renderResults(data) {
            const { products, total_results, page, size } = data;

            resultsCount.textContent = `Showing ${products.length} of ${total_results} results (page ${page})`;
            resultsInfo.style.display = 'block';

            if (!products || products.length === 0) {
                productsGrid.innerHTML = '<div style="color:white;font-size:18px;">No products found.</div>';
                return;
            }

            productsGrid.innerHTML = products.map(product => `
                <div class="product-card">
                    ${product.image_url ? `<img src="${product.image_url}" alt="${product.title}" class="product-image" />` : `<div class="product-image"></div>`}
                    <div class="product-info">
                        <div class="product-title">${product.title || 'Unknown Product'}</div>
                        ${product.brand ? `<div class="product-brand">${product.brand}</div>` : ''}
                        <div class="product-price">${product.price ? `$${product.price.toFixed(2)}` : 'N/A'}</div>
                        <div class="product-rating">
                            <span>⭐</span>
                            <span>${product.rating ? product.rating.toFixed(1) : 'N/A'}</span>
                            <span class="count">${product.review_count ? `(${product.review_count})` : ''}</span>
                        </div>
                        <div class="product-platform">${product.platform}</div>
                        <div class="product-availability">${product.availability || 'unknown'}</div>
                    </div>
                </div>
            `).join('');
        }
    </script>
</body>
</html>
